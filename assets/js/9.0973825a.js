(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{270:function(t,a,s){"use strict";s.r(a);var e=s(38),n=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"github-actions-あれこれ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-あれこれ","aria-hidden":"true"}},[t._v("#")]),t._v(" Github Actions あれこれ")]),t._v(" "),s("h2",{attrs:{id:"全般"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全般","aria-hidden":"true"}},[t._v("#")]),t._v(" 全般")]),t._v(" "),s("h3",{attrs:{id:"github-actions-テンプレート"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-テンプレート","aria-hidden":"true"}},[t._v("#")]),t._v(" GitHub Actions テンプレート")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/Mushus/ghp/blob/master/.github/workflows/deployment.yml",target:"_blank",rel:"noopener noreferrer"}},[t._v("ただチェックアウトするだけ"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"資料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#資料","aria-hidden":"true"}},[t._v("#")]),t._v(" 資料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/sdras/awesome-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("awesome actions"),s("OutboundLink")],1),t._v(" 何ができるかとか")])]),t._v(" "),s("h3",{attrs:{id:"アクションの定義方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#アクションの定義方法","aria-hidden":"true"}},[t._v("#")]),t._v(" アクションの定義方法")]),t._v(" "),s("p",[s("strong",[t._v("方法 1")])]),t._v(" "),s("p",[t._v("ガッツリしたアクション -> "),s("a",{attrs:{href:"https://github.com/Mushus/golangci-lint-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mushus/golangci-lint-actions"),s("OutboundLink")],1),t._v(" みたいに適当なリポジトリ作ってルートに配置すると良さそう")]),t._v(" "),s("p",[t._v("DockerHub にデプロイするまでやるといいのでは？")]),t._v(" "),s("p",[s("strong",[t._v("方法 2")])]),t._v(" "),s("p",[t._v("細々したアクション -> "),s("a",{attrs:{href:"https://github.com/Mushus/github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mushus/github-actions"),s("OutboundLink")],1),t._v(" みたいなリポジトリを作ってフォルダごとに管理すると良さそう。")]),t._v(" "),s("h3",{attrs:{id:"アクションの実装言語"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#アクションの実装言語","aria-hidden":"true"}},[t._v("#")]),t._v(" アクションの実装言語")]),t._v(" "),s("p",[s("strong",[t._v("JavaScript / TypeScript")])]),t._v(" "),s("p",[t._v("言語は固定されるが、指定したステップで実行する以外にジョブの最後に片付け的な処理が挟める ( 若干違うかもしれないが golang の "),s("code",[t._v("defer")]),t._v(" 的なやつ )")]),t._v(" "),s("p",[t._v("現在は "),s("a",{attrs:{href:"https://help.github.com/ja/actions/automating-your-workflow-with-github-actions/workflow-syntax-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("ドキュメント"),s("OutboundLink")],1),t._v(" に載っていないが "),s("a",{attrs:{href:"https://github.com/actions/cache/blob/master/action.yml#L20",target:"_blank",rel:"noopener noreferrer"}},[t._v("公式が使っている"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("strong",[t._v("Docker")])]),t._v(" "),s("p",[t._v("言語は自由に使えるが、JS 系の便利さはない")]),t._v(" "),s("h3",{attrs:{id:"github-actions-上で-docker-はつかえるか"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-上で-docker-はつかえるか","aria-hidden":"true"}},[t._v("#")]),t._v(" GitHub Actions 上で Docker はつかえるか")]),t._v(" "),s("p",[t._v("使える。ただしローカルボリューム ( "),s("code",[t._v('docker run -v "hoge:/hoge"')]),t._v(" とかで作られるやつ ? ) は使えない")]),t._v(" "),s("h3",{attrs:{id:"環境変数-github-token-が使えない"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#環境変数-github-token-が使えない","aria-hidden":"true"}},[t._v("#")]),t._v(" 環境変数 "),s("code",[t._v("GITHUB_TOKEN")]),t._v(" が使えない")]),t._v(" "),s("p",[s("code",[t._v("secrets.GITHUB_TOKEN")]),t._v(" はデフォルトで設定されているが、 環境変数として "),s("code",[t._v("GITHUB_TOKEN")]),t._v(" は存在していない。")]),t._v(" "),s("p",[t._v("使いたい場合は以下を参考に自分で環境変数に設定する必要がある。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("env:\n  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n")])])]),s("h3",{attrs:{id:"secrets-で改行を使いたい。もしくは、改行が使えない"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secrets-で改行を使いたい。もしくは、改行が使えない","aria-hidden":"true"}},[t._v("#")]),t._v(" secrets で改行を使いたい。もしくは、改行が使えない")]),t._v(" "),s("p",[t._v("使える")]),t._v(" "),s("p",[t._v("原因は環境変数からファイルに書き出したりする部分にあり、")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# 以下を\necho "$DEPLOY_KEY"\n# に変更する\necho -e "DEPLOY_KEY"\n')])])]),s("p",[t._v("でできるようになる。")]),t._v(" "),s("h2",{attrs:{id:"aws"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aws","aria-hidden":"true"}},[t._v("#")]),t._v(" AWS")]),t._v(" "),s("h3",{attrs:{id:"s3-にアップロードしたい"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#s3-にアップロードしたい","aria-hidden":"true"}},[t._v("#")]),t._v(" S3 にアップロードしたい")]),t._v(" "),s("p",[t._v("2019-12-18 現在、 Github Actions 公式の "),s("a",{attrs:{href:"https://github.com/actions/aws",target:"_blank",rel:"noopener noreferrer"}},[t._v("actions/aws"),s("OutboundLink")],1),t._v(" は Deprecated になってしまっている。")]),t._v(" "),s("p",[t._v("AWS 公式の "),s("a",{attrs:{href:"https://github.com/aws-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("aws-actions"),s("OutboundLink")],1),t._v(" には S3 へのアップロードアクションが存在せず、残念ながら公式のサポートがなくなってしまっている。")]),t._v(" "),s("p",[t._v("なので非公式の "),s("a",{attrs:{href:"https://github.com/jakejarvis/s3-sync-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("jakejarvis/s3-sync-action"),s("OutboundLink")],1),t._v(" を使用する。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://gist.github.com/Mushus/e3f10d65eea2daa92f372f0d5d2c5387",target:"_blank",rel:"noopener noreferrer"}},[t._v("以下"),s("OutboundLink")],1),t._v("に node のプロジェクトをビルド後 S3 にデプロイする方法を示す。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy S3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("push"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy S3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v1\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"12.x"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          yarn\n          yarn build")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jakejarvis/s3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("delete\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_S3_BUCKET")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.BUCKET_NAME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_ACCESS_KEY_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.AWS_ACCESS_KEY_ID "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_SECRET_ACCESS_KEY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.AWS_SECRET_ACCESS_KEY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_REGION")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"us-west-1"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SOURCE_DIR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dist"')]),t._v("\n")])])]),s("p",[t._v("公式のものが正式にリリースされたらそちらに乗り換えたいところ。")])])},[],!1,null,null,null);a.default=n.exports}}]);