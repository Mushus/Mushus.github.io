(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{268:function(t,s,a){"use strict";a.r(s);var n=a(38),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"github-actions-あれこれ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-あれこれ","aria-hidden":"true"}},[t._v("#")]),t._v(" Github Actions あれこれ")]),t._v(" "),a("h2",{attrs:{id:"全般"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全般","aria-hidden":"true"}},[t._v("#")]),t._v(" 全般")]),t._v(" "),a("h3",{attrs:{id:"環境変数-github-token-が使えない"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#環境変数-github-token-が使えない","aria-hidden":"true"}},[t._v("#")]),t._v(" 環境変数 "),a("code",[t._v("GITHUB_TOKEN")]),t._v(" が使えない")]),t._v(" "),a("p",[a("code",[t._v("secrets.GITHUB_TOKEN")]),t._v(" はデフォルトで設定されているが、 環境変数として "),a("code",[t._v("GITHUB_TOKEN")]),t._v(" は存在していない。")]),t._v(" "),a("p",[t._v("使いたい場合は以下を参考に自分で環境変数に設定する必要がある。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("env:\n  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n")])])]),a("h3",{attrs:{id:"secrets-で改行を使いたい。もしくは、改行が使えない"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secrets-で改行を使いたい。もしくは、改行が使えない","aria-hidden":"true"}},[t._v("#")]),t._v(" secrets で改行を使いたい。もしくは、改行が使えない")]),t._v(" "),a("p",[t._v("使える")]),t._v(" "),a("p",[t._v("原因は環境変数からファイルに書き出したりする部分にあり、")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# 以下を\necho "$DEPLOY_KEY"\n# に変更する\necho -e "DEPLOY_KEY"\n')])])]),a("p",[t._v("でできるようになる。")]),t._v(" "),a("h2",{attrs:{id:"aws"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aws","aria-hidden":"true"}},[t._v("#")]),t._v(" AWS")]),t._v(" "),a("h3",{attrs:{id:"s3-にアップロードしたい"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#s3-にアップロードしたい","aria-hidden":"true"}},[t._v("#")]),t._v(" S3 にアップロードしたい")]),t._v(" "),a("p",[t._v("2019-12-18 現在、 Github Actions 公式の "),a("a",{attrs:{href:"https://github.com/actions/aws",target:"_blank",rel:"noopener noreferrer"}},[t._v("actions/aws"),a("OutboundLink")],1),t._v(" は Deprecated になってしまっている。")]),t._v(" "),a("p",[t._v("AWS 公式の "),a("a",{attrs:{href:"https://github.com/aws-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("aws-actions"),a("OutboundLink")],1),t._v(" には S3 へのアップロードアクションが存在せず、残念ながら公式のサポートがなくなってしまっている。")]),t._v(" "),a("p",[t._v("なので非公式の "),a("a",{attrs:{href:"https://github.com/jakejarvis/s3-sync-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("jakejarvis/s3-sync-action"),a("OutboundLink")],1),t._v(" を使用する。")]),t._v(" "),a("p",[t._v("以下に node のプロジェクトをビルド後 S3 にデプロイする方法を示す。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy S3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" push "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy S3\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v1\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'12.x'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          yarn\n          yarn build")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jakejarvis/s3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("delete\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_S3_BUCKET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.BUCKET_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_ACCESS_KEY_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.AWS_ACCESS_KEY_ID "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_SECRET_ACCESS_KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.AWS_SECRET_ACCESS_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_REGION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'us-west-1'")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SOURCE_DIR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist'")]),t._v("\n")])])]),a("p",[t._v("公式のものが正式にリリースされたらそちらに乗り換えたいところ。")])])},[],!1,null,null,null);s.default=e.exports}}]);